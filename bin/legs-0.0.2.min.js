(function(a){var b=this.Legs={VERSION:"0.0.2"};b.Class=function(){this.initialize=function(){},this.proxy=function(b){return a.proxy(b,this)},this.ensure=function(b,c,d){if(a.type(b)!==c)throw new Error(d+' expected argument type "'+c+'" but got "'+a.type(b)+'"')}},b.Class.extend=function(b){var c=function(){this.initialize.apply(this,arguments)};c.extend=this.extend,c.create=this.create,c.include=this.include;var d=new this;a.extend(!0,d,b),c.prototype=d;return c},b.Class.create=function(a){return new(this.extend(a))},b.Class.include=function(b){a.extend(!0,this.prototype,b)},b.Events=b.Class.extend({initialize:function(){this.mappings={},this.STARTUP_COMPLETE="startup complete"},callbacks:function(a){return this.mappings[a]||(this.mappings[a]=[])},bind:function(a,b){this.ensure(a,"string","Legs.Events.bind"),this.callbacks(a).push(b)},unbind:function(b,c){this.ensure(b,"string","Legs.Events.unbind");var d=this.callbacks(b),e=a.inArray(c,d);e>-1&&d.splice(e,1)},trigger:function(b){this.ensure(b,"string","Legs.Events.trigger");var c=a.makeArray(arguments);a(this.callbacks(c.shift())).each(function(a,b){b.apply(null,c)})}}),b.Injector=b.Class.extend({initialize:function(){this.mappings={}},mapValue:function(a,b){this.mappings[a]=function(){return b}},mapClass:function(a,b){this.mappings[a]=function(){return new b}},mapSingleton:function(a,b){this.mappings[a]=function(){var c=new b;this.mapValue(a,c);return c}},injectInto:function(b){for(var c in b)/^_/.test(c)&&a.type(b[c])==="string"&&(b[c.substr(1)]=this.getInstance(b[c]));return b},getInstance:function(a){if(!this.mappings.hasOwnProperty(a))throw new Error('Legs.Injector cannot find any mapping named "'+a+'".');return this.injectInto(this.mappings[a].call(this))},hasMapping:function(a){return this.mappings.hasOwnProperty(a)}}),b.Base=b.Class.extend({_events:"events",_injector:"injector",trigger:function(){this.events.trigger.apply(this.events,arguments)}}),b.Actor=b.Base.extend({}),b.Command=b.Base.extend({execute:function(){}}),b.CommandMap=b.Class.extend({initialize:function(a,b){this.events=a,this.injector=b,this.mappings={}},callbacks:function(a){return this.mappings[a]||(this.mappings[a]=[])},mapEvent:function(a,b,c){var d=function(){var d=this.injector.injectInto(new b);c===!0&&this.unmapEvent(a,b),d.execute.apply(d,arguments)},e={commandClass:b,callback:this.proxy(d)};this.callbacks(a).push(e),this.events.bind(a,e.callback)},unmapEvent:function(b,c){var d=this.callbacks(b);a(d).each(this.proxy(function(a,e){e.commandClass===c&&(d.splice(a,1),this.events.unbind(b,e.callback))}))},hasEventCommand:function(a,b){var c=this.callbacks(a);for(var d=0;d<c.length;d++)if(c[d].commandClass===b)return!0;return!1},execute:function(){var b=a.makeArray(arguments),c=b.shift(),d=this.injector.injectInto(new c);d.execute.apply(d,b)}}),b.Context=b.Class.extend({contextView:a(document),initialize:function(){this.events=b.Events.create(this.events),this.injector=new b.Injector,this.commandMap=new b.CommandMap(this.events,this.injector),this.startup(),this.mapInjections(),this.autoStartup&&this.postStartup()},startup:function(){},postStartup:function(){this.events.trigger(this.events.STARTUP_COMPLETE)},autoStartup:!0,mapInjections:function(){this.injector.mapValue("events",this.events),this.injector.mapValue("injector",this.injector),this.injector.mapValue("commandmap",this.commandMap),this.injector.mapValue("contextview",this.contextView)}})})(jQuery)